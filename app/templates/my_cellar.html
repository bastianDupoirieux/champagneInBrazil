<!DOCTYPE html>
<html>
<head>
    <title>My Cellar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="layout">
        <div class="topbar">
            <button class="menu-toggle" id="menuToggle">≡</button>
            <h1>My Cellar</h1>
        </div>
        <aside class="sidebar" id="sidebar">
            <a class="nav-btn" href="{{ url_for('my_cellar') }}">My Cellar</a>
            <a class="nav-btn" href="{{ url_for('experienced_wines') }}">Experienced Wines</a>
            <a class="nav-btn" href="{{ url_for('analytics') }}">Analytics</a>
            <a class="nav-btn" href="{{ url_for('map_page') }}">Map</a>
        </aside>
        <main class="content">
            <ul class="wine-list">
                {% for row in wines %}
                    <li class="wine-item">
                        <img class="wine-thumb" src="{{ url_for('static', filename='bottle.svg') }}" alt="wine bottle">
                        <span class="wine-name">
                            {{ row.name }}{% if row.producer %} - {{ row.producer }}{% endif %}{% if row.vintage %} ({{ row.vintage }}){% endif %}
                        </span>
                        <div class="wine-actions">
                            <button class="dropdown-toggle" data-wine-id="{{ row.id }}">⋮</button>
                            <div class="dropdown-menu" id="dropdown-{{ row.id }}" style="display: none;">
                                <a href="{{ url_for('wine_detail', wine_id=row.id) }}">View Wine</a>
                                <a href="{{ url_for('edit_wine', wine_id=row.id) }}">Edit Wine</a>
                                <a href="{{ url_for('delete_wine', wine_id=row.id) }}" onclick="return confirm('Are you sure you want to delete this wine?')">Delete Wine</a>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </main>
        <button class="fab" id="openAdd">+</button>
    </div>

    <div class="modal" id="addModal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeAdd">&times;</span>
            <h2>Add a Wine</h2>
            <form method="POST" action="{{ url_for('add_wine') }}">
                {% for col in columns %}
                    <label>{{ col|replace('_', ' ')|title }}:</label>
                    <input type="text" name="{{ col }}"><br>
                {% endfor %}
                <button type="submit">Submit</button>
            </form>
        </div>
    </div>

    <script>
        const openBtn = document.getElementById('openAdd');
        const closeBtn = document.getElementById('closeAdd');
        const modal = document.getElementById('addModal');
        openBtn.addEventListener('click', () => { modal.style.display = 'block'; });
        closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });
        window.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const layout = document.querySelector('.layout');
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            layout.classList.toggle('sidebar-open');
        });

        // Dropdown functionality
        document.querySelectorAll('.dropdown-toggle').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                const wineId = this.dataset.wineId;
                const dropdown = document.getElementById(`dropdown-${wineId}`);
                
                // Close all other dropdowns
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    if (menu.id !== `dropdown-${wineId}`) {
                        menu.style.display = 'none';
                    }
                });
                
                // Toggle current dropdown
                dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function() {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.style.display = 'none';
            });
        });
    </script>
</body>
</html>

